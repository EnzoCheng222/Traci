# 交通號誌控制方法比較實驗（3 次重複實驗）

## 📋 實驗概述

### 實驗目的
比較三種不同交通號誌控制方法的性能表現：
1. **PPO (Proximal Policy Optimization)** - 強化學習方法
2. **Max Pressure** - 壓力型規則方法  
3. **Webster + PID** - 公式型預測方法

### 實驗設計
- **重複次數**: 每個方法執行 **3 次**
- **統計方法**: 計算平均值 (Mean) 和標準差 (Std)
- **可靠性**: 透過多次實驗確保結果穩定性
- **比較基準**: 使用平均值進行方法間比較

### 實驗環境
- **模擬器**: SUMO (Simulation of Urban MObility)
- **模擬時間**: 1800 秒 (30 分鐘)
- **時間步長**: 0.1 秒 (總步數: 18,000 步)
- **路口配置**: Node2 十字路口
- **車道配置**: 東西向 3 車道，南北向 3 車道
- **最小綠燈時間**: 10 秒 (100 steps)
- **黃燈時間**: 3 秒 (30 steps)

### 評估指標

| 指標 | 說明 | 單位 | 優化目標 |
|------|------|------|---------|
| **EB 平均排隊** | 東向平均排隊車輛數 | veh | ↓ 越低越好 |
| **SB 平均排隊** | 南向平均排隊車輛數 | veh | ↓ 越低越好 |
| **Total Avg Queue** | 總平均排隊長度 | veh | ↓ 越低越好 |
| **EB 平均停等** | 東向平均停等車輛數 | veh | ↓ 越低越好 |
| **SB 平均停等** | 南向平均停等車輛數 | veh | ↓ 越低越好 |
| **平均延滯時間** | 每輛車平均延滯 | sec/veh | ↓ 越低越好 |
| **總停等時間** | 累積停等時間 | veh·sec | ↓ 越低越好 |
| **EB 綠燈比例** | 東向綠燈時間比例 | - | 平衡 |
| **SB 綠燈比例** | 南向綠燈時間比例 | - | 平衡 |
| **黃燈比例** | 黃燈時間比例 | - | ↓ 越低越好 |
| **總到達車輛** | 完成通過路口的車輛數 | veh | ↑ 越高越好 |
| **Cumulative Reward** | 累積獎勵值 | - | ↑ 越高越好 |

---

## 🔬 實驗一：PPO 強化學習方法

### 方法描述
- **演算法**: Proximal Policy Optimization (PPO)
- **程式**: `traci.PPO.update.py`
- **控制類型**: 學習型 (Learning-based)
- **決策方式**: 透過與環境互動學習最優策略
- **State 空間**: 13 維 (6 queue + 6 halting + 1 phase)
- **Action 空間**: 2 動作 (保持 / 切換)
- **優化目標**: 最小化停等車輛數 (Minimize Halting)

### 超參數設定
```python
GAMMA = 0.9                    # 折扣因子
LAMBDA = 0.95                  # GAE 參數
CLIP_EPS = 0.2                 # PPO Clipping
POLICY_LR = 1e-4               # Policy 學習率
VALUE_LR = 1e-4                # Value 學習率
PPO_EPOCHS = 4                 # 更新輪數
PPO_BATCH_SIZE = 64            # 批次大小
PPO_UPDATE_INTERVAL = 512      # 更新間隔
```

### 實驗結果

#### 執行記錄

| 執行次數 | 開始時間 | 結束時間 | 執行時長 (分鐘) |
|---------|---------|---------|----------------|
| **Run 1** | | | |
| **Run 2** | | | |
| **Run 3** | | | |

#### 詳細性能指標（3 次實驗）

| 指標 | Run 1 | Run 2 | Run 3 | **平均值 ± 標準差** |
|------|-------|-------|-------|-------------------|
| **EB 平均排隊 (veh)** | | | | **±** |
| **SB 平均排隊 (veh)** | | | | **±** |
| **Total Avg Queue (veh)** | | | | **±** |
| **EB 平均停等 (veh)** | | | | **±** |
| **SB 平均停等 (veh)** | | | | **±** |
| **EB 綠燈比例** | | | | **±** |
| **SB 綠燈比例** | | | | **±** |
| **黃燈比例** | | | | **±** |
| **Total Arrived Veh** | | | | **±** |
| **Avg Delay Time (sec/veh)** | | | | **±** |
| **Total Waiting Time (veh·sec)** | | | | **±** |
| **Cumulative Reward** | | | | **±** |

#### 相位分配比例（3 次平均）

| Phase | Run 1 | Run 2 | Run 3 | **平均值** | 說明 |
|-------|-------|-------|-------|-----------|------|
| Phase 0 | | | | | |
| Phase 1 | | | | | |
| Phase 2 | | | | | |
| Phase 3 | | | | | |

### 觀察與分析

#### 穩定性分析
- **最穩定指標**（標準差最小）: 
- **波動最大指標**（標準差最大）: 
- **整體穩定性**: ⭐⭐⭐⭐⭐ (1-5 星)

#### 優點
- 

#### 缺點
- 

#### 特殊現象
- **Run 1**: 
- **Run 2**: 
- **Run 3**: 
- **共同現象**: 

---

## 🔬 實驗二：Max Pressure 壓力型方法

### 方法描述
- **演算法**: Max Pressure with Yellow Cost Consideration
- **程式**: `traci.maxpressure.yellow_cost.py`
- **控制類型**: 規則型 (Rule-based)
- **決策方式**: 根據東西向與南北向的即時壓力差決策
- **切換閾值**: 壓力差 ≥ 15 輛車
- **優化目標**: 最小化停等車輛數 (Minimize Halting)

### 控制邏輯
```python
if pressure_diff >= SWITCH_THRESHOLD:
    if q_EB > q_SB:
        # 切換到東西向 (如果不在 EB 相位)
    elif q_SB > q_EB:
        # 切換到南北向 (如果不在 SB 相位)
```

### 實驗結果

#### 執行記錄

| 執行次數 | 開始時間 | 結束時間 | 執行時長 (分鐘) |
|---------|---------|---------|----------------|
| **Run 1** | | | |
| **Run 2** | | | |
| **Run 3** | | | |

#### 詳細性能指標（3 次實驗）

| 指標 | Run 1 | Run 2 | Run 3 | **平均值 ± 標準差** |
|------|-------|-------|-------|-------------------|
| **EB 平均排隊 (veh)** | | | | **±** |
| **SB 平均排隊 (veh)** | | | | **±** |
| **Total Avg Queue (veh)** | | | | **±** |
| **EB 平均停等 (veh)** | | | | **±** |
| **SB 平均停等 (veh)** | | | | **±** |
| **EB 綠燈比例** | | | | **±** |
| **SB 綠燈比例** | | | | **±** |
| **黃燈比例** | | | | **±** |
| **Total Arrived Veh** | | | | **±** |
| **Avg Delay Time (sec/veh)** | | | | **±** |
| **Total Waiting Time (veh·sec)** | | | | **±** |
| **Cumulative Reward** | | | | **±** |

#### 相位分配比例（3 次平均）

| Phase | Run 1 | Run 2 | Run 3 | **平均值** | 說明 |
|-------|-------|-------|-------|-----------|------|
| Phase 0 | | | | | |
| Phase 1 | | | | | |
| Phase 2 | | | | | |
| Phase 3 | | | | | |

### 觀察與分析

#### 穩定性分析
- **最穩定指標**（標準差最小）: 
- **波動最大指標**（標準差最大）: 
- **整體穩定性**: ⭐⭐⭐⭐⭐ (1-5 星)

#### 優點
- 

#### 缺點
- 

#### 特殊現象
- **Run 1**: 
- **Run 2**: 
- **Run 3**: 
- **共同現象**: 

---

## 🔬 實驗三：Webster + PID 公式型方法

### 方法描述
- **演算法**: Webster Method + PID Control
- **程式**: `traci.Webster_PID.py`
- **控制類型**: 公式型 (Formula-based)
- **決策方式**: 基於 Webster 公式計算最優週期，使用 PID 動態調整
- **控制週期**: 每 200 steps (20 秒) 更新一次
- **優化目標**: 最小化停等車輛數 (Minimize Halting)

### 核心參數
```python
SATURATION_FLOW_RATE = 1600.0  # veh/hr/lane (飽和流率)
MIN_CYCLE = 40.0               # 最小週期 (秒)
MAX_CYCLE = 150.0              # 最大週期 (秒)
MIN_GREEN = 10.0               # 最小綠燈時間 (秒)
LOST_PER_PHASE = 5.0           # 每相位損失時間 (秒)

# PID 參數
PID_Kp = 0.5                   # 比例增益
PID_Ti = 15.0                  # 積分時間常數
PID_Td = 4.0                   # 微分時間常數
```

### 實驗結果

#### 執行記錄

| 執行次數 | 開始時間 | 結束時間 | 執行時長 (分鐘) |
|---------|---------|---------|----------------|
| **Run 1** | | | |
| **Run 2** | | | |
| **Run 3** | | | |

#### 詳細性能指標（3 次實驗）

| 指標 | Run 1 | Run 2 | Run 3 | **平均值 ± 標準差** |
|------|-------|-------|-------|-------------------|
| **EB 平均排隊 (veh)** | | | | **±** |
| **SB 平均排隊 (veh)** | | | | **±** |
| **Total Avg Queue (veh)** | | | | **±** |
| **EB 平均停等 (veh)** | | | | **±** |
| **SB 平均停等 (veh)** | | | | **±** |
| **EB 綠燈比例** | | | | **±** |
| **SB 綠燈比例** | | | | **±** |
| **黃燈比例** | | | | **±** |
| **Total Arrived Veh** | | | | **±** |
| **Avg Delay Time (sec/veh)** | | | | **±** |
| **Total Waiting Time (veh·sec)** | | | | **±** |
| **Cumulative Reward** | | | | **±** |

#### 相位分配比例（3 次平均）

| Phase | Run 1 | Run 2 | Run 3 | **平均值** | 說明 |
|-------|-------|-------|-------|-----------|------|
| Phase 0 | | | | | EB 左轉 |
| Phase 1 | | | | | 黃燈 |
| Phase 2 | | | | | EB 直行+右轉 |
| Phase 3 | | | | | 黃燈 |
| Phase 4 | | | | | SB 左轉 |
| Phase 5 | | | | | 黃燈 |
| Phase 6 | | | | | SB 直行+右轉 |
| Phase 7 | | | | | 黃燈 |

### 觀察與分析

#### 穩定性分析
- **最穩定指標**（標準差最小）: 
- **波動最大指標**（標準差最大）: 
- **整體穩定性**: ⭐⭐⭐⭐⭐ (1-5 星)

#### 優點
- 

#### 缺點
- 

#### 特殊現象
- **Run 1**: 
- **Run 2**: 
- **Run 3**: 
- **共同現象**: 

---

## 📊 綜合比較分析（基於 3 次實驗平均值）

### 性能指標對比總表

| 指標 | PPO<br>(Mean ± Std) | Max Pressure<br>(Mean ± Std) | Webster + PID<br>(Mean ± Std) | **最佳方法** |
|------|-------------------|----------------------------|----------------------------|-----------|
| **EB 平均排隊** | ± | ± | ± | |
| **SB 平均排隊** | ± | ± | ± | |
| **Total Avg Queue** | ± | ± | ± | |
| **EB 平均停等** | ± | ± | ± | |
| **SB 平均停等** | ± | ± | ± | |
| **平均延滯時間** | ± | ± | ± | |
| **總停等時間** | ± | ± | ± | |
| **總到達車輛** | ± | ± | ± | |
| **EB 綠燈比例** | ± | ± | ± | |
| **SB 綠燈比例** | ± | ± | ± | |
| **黃燈比例** | ± | ± | ± | |
| **Cumulative Reward** | ± | ± | ± | |

### 性能排名（基於平均值）

#### 1️⃣ 總平均排隊長度 (Total Avg Queue)
1. **方法**: XXX (**XX.XX ± X.XX** veh)
2. **方法**: XXX (**XX.XX ± X.XX** veh)
3. **方法**: XXX (**XX.XX ± X.XX** veh)

#### 2️⃣ 平均停等車輛 (Average Halting)
1. **方法**: XXX (**XX.XX ± X.XX** veh)
2. **方法**: XXX (**XX.XX ± X.XX** veh)
3. **方法**: XXX (**XX.XX ± X.XX** veh)

#### 3️⃣ 平均延滯時間 (Average Delay)
1. **方法**: XXX (**XX.XX ± X.XX** sec/veh)
2. **方法**: XXX (**XX.XX ± X.XX** sec/veh)
3. **方法**: XXX (**XX.XX ± X.XX** sec/veh)

#### 4️⃣ 總停等時間 (Total Waiting Time)
1. **方法**: XXX (**XXXX.XX ± XX.XX** veh·sec)
2. **方法**: XXX (**XXXX.XX ± XX.XX** veh·sec)
3. **方法**: XXX (**XXXX.XX ± XX.XX** veh·sec)

#### 5️⃣ 通過車輛數 (Throughput)
1. **方法**: XXX (**XXXX ± XX** veh)
2. **方法**: XXX (**XXXX ± XX** veh)
3. **方法**: XXX (**XXXX ± XX** veh)

### 穩定性排名（基於標準差）

#### 結果穩定性比較
| 方法 | 最穩定指標 | 最不穩定指標 | 整體穩定性評分 |
|------|----------|------------|-------------|
| **PPO** | | | ⭐⭐⭐⭐⭐ |
| **Max Pressure** | | | ⭐⭐⭐⭐⭐ |
| **Webster + PID** | | | ⭐⭐⭐⭐⭐ |

### 方法特性比較

| 特性 | PPO | Max Pressure | Webster + PID |
|------|-----|--------------|---------------|
| **控制哲學** | 學習型 | 反應型 | 預測型 |
| **需要訓練** | ✅ 是 | ❌ 否 | ❌ 否 |
| **計算複雜度** | 高 | 低 | 中 |
| **適應性** | 高（可學習） | 中（規則固定） | 中（公式計算） |
| **可解釋性** | 低（黑盒） | 高（邏輯清晰） | 高（公式明確） |
| **參數調整** | 複雜 | 簡單 | 中等 |
| **實時性** | 中 | 高 | 中 |
| **結果穩定性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

### 視覺化比較（基於平均值）

#### 排隊長度比較
```
PPO:            ████████████████░░░░ XX.XX ± X.XX veh
Max Pressure:   ██████████████████░░ XX.XX ± X.XX veh
Webster + PID:  ███████████████████░ XX.XX ± X.XX veh
                0    10    20    30    40    50
```

#### 停等時間比較
```
PPO:            ████████████████░░░░ XX.XX ± X.XX sec/veh
Max Pressure:   ██████████████████░░ XX.XX ± X.XX sec/veh
Webster + PID:  ███████████████████░ XX.XX ± X.XX sec/veh
                0     5     10    15    20
```

---

## 🎯 結論與建議

### 統計顯著性分析
- **最佳方法的優勢是否顯著？**: 
- **標準差重疊情況**: 
- **建議**: 如果標準差重疊嚴重，表示方法間差異不大

### 主要發現

#### 1. 最佳方法
- **整體性能最佳**: [方法名稱] (**XX.XX ± X.XX**)
- **原因**: 
- **優勢領域**: 

#### 2. 穩定性分析
- **最穩定方法**: [方法名稱] (標準差最小)
- **最不穩定方法**: [方法名稱] (標準差最大)
- **穩定性重要性**: 

#### 3. 方法優劣總結

**PPO 強化學習**
- ✅ **優點**: 
- ❌ **缺點**: 
- 📊 **穩定性**: 

**Max Pressure**
- ✅ **優點**: 
- ❌ **缺點**: 
- 📊 **穩定性**: 

**Webster + PID**
- ✅ **優點**: 
- ❌ **缺點**: 
- 📊 **穩定性**: 

### 適用場景建議

#### PPO 強化學習
**適合**:
- 交通流量模式複雜且多變
- 有足夠的訓練時間和計算資源
- 可接受一定程度的性能波動

**不適合**:
- 需要極高穩定性
- 計算資源有限
- 需要立即部署

#### Max Pressure
**適合**:
- 需要快速響應即時交通狀況
- 計算資源有限
- 需要穩定可靠的控制

**不適合**:
- 交通流量變化緩慢且可預測
- 需要長期優化規劃

#### Webster + PID
**適合**:
- 交通流量相對穩定且可預測
- 需要理論支撐和公式依據
- 需要固定週期的控制

**不適合**:
- 交通流量突變頻繁
- 需要即時反應能力

### 未來改進方向

1. **增加實驗次數**: 目前 3 次，建議增加到 5-10 次以提高統計可靠性
2. **不同交通流量情境**: 測試高峰/離峰/混合流量
3. **參數敏感度分析**: 研究關鍵參數對性能的影響
4. **混合方法**: 結合不同方法的優點

### 研究貢獻

本實驗的主要貢獻:
1. **公平比較**: 統一目標函數和黃燈機制
2. **統計可靠**: 3 次重複實驗提供平均值和標準差
3. **全面評估**: 12 個評估指標的完整分析
4. **實務建議**: 提供不同場景的方法選擇建議

---

## 📎 附錄

### A. 實驗環境配置
```
SUMO 版本: 1.24.0
Python 版本: 3.12
作業系統: Windows
實驗日期: YYYY-MM-DD
```

### B. 程式檔案清單
- `traci.PPO.update.py` - PPO 演算法實作
- `traci.maxpressure.yellow_cost.py` - Max Pressure 實作
- `traci.Webster_PID.py` - Webster + PID 實作
- `Traci.net.xml` - 路網配置
- `Traci.rou.xml` - 車流配置
- `Traci.add.xml` - 偵測器配置

### C. 原始數據紀錄

#### PPO 原始輸出
```
Run 1:
[貼上完整終端輸出]

Run 2:
[貼上完整終端輸出]

Run 3:
[貼上完整終端輸出]
```

#### Max Pressure 原始輸出
```
Run 1:
[貼上完整終端輸出]

Run 2:
[貼上完整終端輸出]

Run 3:
[貼上完整終端輸出]
```

#### Webster + PID 原始輸出
```
Run 1:
[貼上完整終端輸出]

Run 2:
[貼上完整終端輸出]

Run 3:
[貼上完整終端輸出]
```

### D. 參考文獻
1. Schulman, J., et al. (2017). Proximal Policy Optimization Algorithms.
2. Varaiya, P. (2013). Max pressure control of a network of signalized intersections.
3. Webster, F. V. (1958). Traffic signal settings. Road Research Technical Paper.

---

**📝 快速填寫指引**

每次實驗完成後，按以下步驟填寫：

1. **複製終端輸出的 Summary 部分**
2. **填入對應的 Run X 欄位**（精確到小數點後 2 位）
3. **記錄執行時間**
4. **3 次完成後，計算平均值和標準差**
   - 平均值 = (Run1 + Run2 + Run3) / 3
   - 標準差 = sqrt(((Run1-Mean)² + (Run2-Mean)² + (Run3-Mean)²) / 3)

**範例**：
```
Run 1: 25.37
Run 2: 26.15  
Run 3: 24.89
---
Mean = (25.37 + 26.15 + 24.89) / 3 = 25.47
Std = sqrt(((25.37-25.47)² + (26.15-25.47)² + (24.89-25.47)²) / 3) = 0.51
結果: 25.47 ± 0.51
```

---

**文件建立時間**: 2025-11-26
**最後更新時間**: YYYY-MM-DD HH:MM:SS

# äº¤é€šè™ŸèªŒæ§åˆ¶æ¼”ç®—æ³•èªªæ˜æ–‡ä»¶

**æ–‡ä»¶ç‰ˆæœ¬**: 1.0  
**æœ€å¾Œæ›´æ–°**: 2025-11-27  
**å°ˆæ¡ˆ**: äº¤é€šè™ŸèªŒæ§åˆ¶æ–¹æ³•æ¯”è¼ƒå¯¦é©—

---

## ç›®éŒ„

1. [PPO å¼·åŒ–å­¸ç¿’æ–¹æ³•](#1-ppo-å¼·åŒ–å­¸ç¿’æ–¹æ³•)
2. [Max Pressure æ–¹æ³•](#2-max-pressure-æ–¹æ³•)
3. [Webster + PID æ–¹æ³•](#3-webster--pid-æ–¹æ³•)
4. [LLM (Gemini) æ–¹æ³•](#4-llm-gemini-æ–¹æ³•)
5. [æ¼”ç®—æ³•æ¯”è¼ƒç¸½çµ](#5-æ¼”ç®—æ³•æ¯”è¼ƒç¸½çµ)

---

## 1. PPO å¼·åŒ–å­¸ç¿’æ–¹æ³•

### **åŸºæœ¬åŸç†**
PPO (Proximal Policy Optimization) æ˜¯ä¸€ç¨®å¼·åŒ–å­¸ç¿’æ¼”ç®—æ³•ï¼Œé€éèˆ‡ç’°å¢ƒäº’å‹•å­¸ç¿’æœ€å„ªæ§åˆ¶ç­–ç•¥ã€‚Agent è§€å¯Ÿäº¤é€šç‹€æ…‹ï¼Œé¸æ“‡ç›¸ä½å‹•ä½œï¼Œä¸¦æ ¹æ“šçå‹µä¿¡è™Ÿèª¿æ•´ç­–ç•¥ã€‚

### **ç¨‹å¼æª”æ¡ˆ**
- `traci.PPO.update.py`

### **ç‹€æ…‹ç©ºé–“ (State)**
æ¯å€‹æ™‚é–“æ­¥æ”¶é›†ä»¥ä¸‹è³‡è¨Šï¼š
- **EB æ–¹å‘**ï¼š
  - æ’éšŠè»Šè¼›æ•¸ (Queue)ï¼š3 å€‹è»Šé“
  - åœç­‰è»Šè¼›æ•¸ (Halting)ï¼š3 å€‹è»Šé“
- **SB æ–¹å‘**ï¼š
  - æ’éšŠè»Šè¼›æ•¸ (Queue)ï¼š3 å€‹è»Šé“
  - åœç­‰è»Šè¼›æ•¸ (Halting)ï¼š3 å€‹è»Šé“
- **ç•¶å‰ç›¸ä½** (Current Phase)ï¼š0, 1, 2, 3
- **ç›¸ä½æŒçºŒæ™‚é–“** (Phase Duration)

**ç‹€æ…‹å‘é‡ç¶­åº¦**: 13 ç¶­

### **å‹•ä½œç©ºé–“ (Action)**
- **é›¢æ•£å‹•ä½œ**ï¼š4 å€‹ç›¸ä½
  - Phase 0: EB ç¶ ç‡ˆ (æ±è¥¿å‘)
  - Phase 1: EB é»ƒç‡ˆ
  - Phase 2: SB ç¶ ç‡ˆ (å—åŒ—å‘)
  - Phase 3: SB é»ƒç‡ˆ

### **çå‹µå‡½æ•¸ (Reward)**
```python
reward = -(halting_EB + halting_SB)
```
- ç›®æ¨™ï¼šæœ€å°åŒ–åœç­‰è»Šè¼›æ•¸
- è² çå‹µè¨­è¨ˆï¼šåœç­‰è»Šè¼›è¶Šå¤šï¼Œæ‡²ç½°è¶Šå¤§

### **æ§åˆ¶æµç¨‹**

```
1. åˆå§‹åŒ–
   â”œâ”€ è¼‰å…¥é è¨“ç·´æ¨¡å‹ (ppo_traffic_signal.zip)
   â”œâ”€ å•Ÿå‹• SUMO æ¨¡æ“¬
   â””â”€ åˆå§‹åŒ–çµ±è¨ˆè®Šæ•¸

2. ä¸»æ§åˆ¶è¿´åœˆ (æ¯ 0.1 ç§’)
   â”œâ”€ 2.1 è§€å¯Ÿç•¶å‰ç‹€æ…‹
   â”‚   â”œâ”€ è®€å– EB/SB å„è»Šé“çš„ Queue å’Œ Halting
   â”‚   â”œâ”€ è®€å–ç•¶å‰ç›¸ä½
   â”‚   â””â”€ çµ„æˆç‹€æ…‹å‘é‡ (13 ç¶­)
   â”‚
   â”œâ”€ 2.2 PPO æ±ºç­–
   â”‚   â”œâ”€ å°‡ç‹€æ…‹è¼¸å…¥ç¥ç¶“ç¶²è·¯
   â”‚   â”œâ”€ è¼¸å‡ºå‹•ä½œæ©Ÿç‡åˆ†ä½ˆ
   â”‚   â””â”€ é¸æ“‡æœ€å„ªå‹•ä½œ (ç›¸ä½)
   â”‚
   â”œâ”€ 2.3 åŸ·è¡Œå‹•ä½œ
   â”‚   â”œâ”€ å¦‚æœéœ€è¦åˆ‡æ›ç›¸ä½
   â”‚   â”‚   â”œâ”€ å…ˆåˆ‡æ›åˆ°é»ƒç‡ˆ (3 ç§’)
   â”‚   â”‚   â””â”€ å†åˆ‡æ›åˆ°ç›®æ¨™ç¶ ç‡ˆ
   â”‚   â””â”€ å¦å‰‡ä¿æŒç•¶å‰ç›¸ä½
   â”‚
   â”œâ”€ 2.4 æ”¶é›†çµ±è¨ˆæ•¸æ“š
   â”‚   â”œâ”€ ç´¯ç© Queueã€Halting
   â”‚   â”œâ”€ è¨˜éŒ„ç›¸ä½æ™‚é–“
   â”‚   â””â”€ è¨ˆç®— Reward
   â”‚
   â””â”€ 2.5 æ¨é€²æ¨¡æ“¬ä¸€æ­¥

3. çµæŸ
   â”œâ”€ è¨ˆç®—å¹³å‡å€¼ (Avg Queue, Avg Delay)
   â”œâ”€ è¼¸å‡ºçµ±è¨ˆçµæœ
   â””â”€ é—œé–‰ SUMO
```

### **é—œéµåƒæ•¸**
- **æ¨¡æ“¬æ™‚é–“**: 1800 ç§’ (30 åˆ†é˜)
- **æ™‚é–“æ­¥é•·**: 0.1 ç§’
- **é»ƒç‡ˆæ™‚é–“**: 3 ç§’
- **ç¥ç¶“ç¶²è·¯**: å·²é è¨“ç·´çš„ PPO æ¨¡å‹

### **å„ªé»**
- è‡ªå‹•å­¸ç¿’æœ€å„ªç­–ç•¥
- é©æ‡‰å‹•æ…‹è»Šæµ
- è¡¨ç¾å„ªç•° (å¯¦é©—ä¸­æœ€ä½³)

### **ç¼ºé»**
- éœ€è¦é å…ˆè¨“ç·´
- é»‘ç®±æ¨¡å‹ï¼Œå¯è§£é‡‹æ€§ä½

---

## 2. Max Pressure æ–¹æ³•

### ğŸ“Œ **åŸºæœ¬åŸç†**
Max Pressure æ˜¯ä¸€ç¨®åŸºæ–¼å£“åŠ›å¹³è¡¡çš„è‡ªé©æ‡‰æ§åˆ¶æ–¹æ³•ã€‚è¨ˆç®—æ¯å€‹æ–¹å‘çš„ã€Œå£“åŠ›ã€(æ’éšŠè»Šè¼›æ•¸)ï¼Œé¸æ“‡å£“åŠ›æœ€å¤§çš„æ–¹å‘çµ¦äºˆç¶ ç‡ˆï¼Œä»¥å¹³è¡¡è·¯ç¶²æµé‡ã€‚

### ğŸ”§ **ç¨‹å¼æª”æ¡ˆ**
- `traci.maxpressure.fixed_yellow.compare.py`

### **ç‹€æ…‹è§€æ¸¬**
- **EB å£“åŠ›** = EB æ–¹å‘æ’éšŠè»Šè¼›ç¸½æ•¸
- **SB å£“åŠ›** = SB æ–¹å‘æ’éšŠè»Šè¼›ç¸½æ•¸

### **æ±ºç­–é‚è¼¯**
```python
if queue_EB > queue_SB + THRESHOLD:
    é¸æ“‡ EB ç¶ ç‡ˆ
elif queue_SB > queue_EB + THRESHOLD:
    é¸æ“‡ SB ç¶ ç‡ˆ
else:
    ä¿æŒç•¶å‰ç›¸ä½
```

### ğŸ”„ **æ§åˆ¶æµç¨‹**

```
1. åˆå§‹åŒ–
   â”œâ”€ è¨­å®šåˆ‡æ›é–¾å€¼ (THRESHOLD = 0)
   â”œâ”€ è¨­å®šæœ€å°ç¶ ç‡ˆæ™‚é–“ (MIN_GREEN = 10s)
   â”œâ”€ å•Ÿå‹• SUMO æ¨¡æ“¬
   â””â”€ åˆå§‹åŒ–çµ±è¨ˆè®Šæ•¸

2. ä¸»æ§åˆ¶è¿´åœˆ (æ¯ 0.1 ç§’)
   â”œâ”€ 2.1 è§€å¯Ÿç•¶å‰ç‹€æ…‹
   â”‚   â”œâ”€ è®€å– EB æ’éšŠè»Šè¼›æ•¸ (qEB)
   â”‚   â”œâ”€ è®€å– SB æ’éšŠè»Šè¼›æ•¸ (qSB)
   â”‚   â””â”€ è®€å–ç•¶å‰ç›¸ä½
   â”‚
   â”œâ”€ 2.2 è¨ˆç®—å£“åŠ›å·®
   â”‚   â””â”€ pressure_diff = qEB - qSB
   â”‚
   â”œâ”€ 2.3 Max Pressure æ±ºç­–
   â”‚   â”œâ”€ å¦‚æœ qEB > qSB + THRESHOLD
   â”‚   â”‚   â””â”€ ç›®æ¨™ç›¸ä½ = EB ç¶ ç‡ˆ (Phase 0)
   â”‚   â”œâ”€ å¦‚æœ qSB > qEB + THRESHOLD
   â”‚   â”‚   â””â”€ ç›®æ¨™ç›¸ä½ = SB ç¶ ç‡ˆ (Phase 2)
   â”‚   â””â”€ å¦å‰‡
   â”‚       â””â”€ ä¿æŒç•¶å‰ç›¸ä½
   â”‚
   â”œâ”€ 2.4 åŸ·è¡Œç›¸ä½åˆ‡æ›
   â”‚   â”œâ”€ å¦‚æœéœ€è¦åˆ‡æ›
   â”‚   â”‚   â”œâ”€ æª¢æŸ¥æœ€å°ç¶ ç‡ˆæ™‚é–“ (>= 10s)
   â”‚   â”‚   â”œâ”€ åˆ‡æ›åˆ°é»ƒç‡ˆ (3s)
   â”‚   â”‚   â””â”€ åˆ‡æ›åˆ°ç›®æ¨™ç¶ ç‡ˆ
   â”‚   â””â”€ å¦å‰‡ç¹¼çºŒç•¶å‰ç›¸ä½
   â”‚
   â”œâ”€ 2.5 æ”¶é›†çµ±è¨ˆæ•¸æ“š
   â”‚   â”œâ”€ ç´¯ç© Queueã€Halting
   â”‚   â”œâ”€ è¨˜éŒ„ç›¸ä½æ™‚é–“
   â”‚   â””â”€ è¨ˆç®— Reward
   â”‚
   â””â”€ 2.6 æ¨é€²æ¨¡æ“¬ä¸€æ­¥

3. çµæŸ
   â”œâ”€ è¨ˆç®—å¹³å‡å€¼
   â”œâ”€ è¼¸å‡ºçµ±è¨ˆçµæœ
   â””â”€ é—œé–‰ SUMO
```

### âš™ï¸ **é—œéµåƒæ•¸**
- **åˆ‡æ›é–¾å€¼ (THRESHOLD)**: 0 è»Šè¼›
- **æœ€å°ç¶ ç‡ˆæ™‚é–“ (MIN_GREEN)**: 10 ç§’
- **é»ƒç‡ˆæ™‚é–“ (YELLOW_TIME)**: 3 ç§’
- **æ¨¡æ“¬æ™‚é–“**: 1800 ç§’

### âœ… **å„ªé»**
- ä¸éœ€è¨“ç·´ï¼Œå³æ’å³ç”¨
- ç‰©ç†æ„ç¾©æ˜ç¢º
- æ•ˆèƒ½æ¥µä½³ (èˆ‡ PPO å¹¾ä¹å¹³æ‰‹)
- è¨ˆç®—ç°¡å–®ï¼Œå¯¦æ™‚æ€§å¼·

### âŒ **ç¼ºé»**
- éœ€è¦æº–ç¢ºçš„æª¢æ¸¬å™¨æ•¸æ“š
- å°æ„Ÿæ¸¬å™¨æ•…éšœæ•æ„Ÿ

---

## 3. Webster + PID æ–¹æ³•

### ğŸ“Œ **åŸºæœ¬åŸç†**
çµåˆ Webster é€±æœŸè¨ˆç®—å…¬å¼èˆ‡ PID æ§åˆ¶å™¨ã€‚Webster æ–¹æ³•æ ¹æ“šæµé‡æ¯”è¨ˆç®—æœ€ä½³é€±æœŸå’Œç¶ ç‡ˆæ™‚é–“ï¼ŒPID æ§åˆ¶å™¨æ ¹æ“šæ’éšŠèª¤å·®å‹•æ…‹èª¿æ•´ç¶ ç‡ˆæ™‚é–“ã€‚

### ğŸ”§ **ç¨‹å¼æª”æ¡ˆ**
- `traci.Webster_PID.py`

### ğŸ“Š **ç‹€æ…‹è§€æ¸¬**
- **EB/SB å¹³å‡è»Šè¼›æ•¸** (æ»‘å‹•è¦–çª—å¹³å‡)
- **EB/SB æ’éšŠè»Šè¼›æ•¸**
- **ç•¶å‰ç›¸ä½**

### ğŸ® **æ§åˆ¶é‚è¼¯**

#### **Webster é€±æœŸè¨ˆç®—**
```python
# 1. è¨ˆç®—æµé‡æ¯”
y_EB = flow_EB / saturation_flow_EB
y_SB = flow_SB / saturation_flow_SB
Y = y_EB + y_SB

# 2. è¨ˆç®—æœ€ä½³é€±æœŸ
C = (1.5 * L + 5) / (1 - Y)
# L = æå¤±æ™‚é–“ (2 å€‹ç›¸ä½ Ã— 3 ç§’é»ƒç‡ˆ = 6 ç§’)

# 3. åˆ†é…ç¶ ç‡ˆæ™‚é–“
G_EB = (y_EB / Y) Ã— (C - L)
G_SB = (y_SB / Y) Ã— (C - L)
```

#### **PID èª¿æ•´**
```python
# è¨ˆç®—æ’éšŠèª¤å·®
error_EB = target_queue - current_queue_EB
error_SB = target_queue - current_queue_SB

# PID è¼¸å‡º
adjustment_EB = Kp Ã— error + Ki Ã— integral + Kd Ã— derivative
G_EB_adjusted = G_EB + adjustment_EB
```

### ğŸ”„ **æ§åˆ¶æµç¨‹**

```
1. åˆå§‹åŒ–
   â”œâ”€ è¨­å®š Webster åƒæ•¸
   â”‚   â”œâ”€ é£½å’Œæµç‡ (SATURATION_FLOW_RATE = 1800 veh/h)
   â”‚   â”œâ”€ æœ€å°/æœ€å¤§é€±æœŸ (30s / 120s)
   â”‚   â””â”€ æå¤±æ™‚é–“ (LOST_PER_PHASE = 3s)
   â”œâ”€ è¨­å®š PID åƒæ•¸
   â”‚   â”œâ”€ Kp = 0.5
   â”‚   â”œâ”€ Ki = 0.1
   â”‚   â””â”€ Kd = 0.2
   â””â”€ å•Ÿå‹• SUMO æ¨¡æ“¬

2. ä¸»æ§åˆ¶è¿´åœˆ (æ¯ 0.1 ç§’)
   â”œâ”€ 2.1 è§€å¯Ÿç•¶å‰ç‹€æ…‹
   â”‚   â”œâ”€ è®€å– EB/SB è»Šè¼›æ•¸
   â”‚   â”œâ”€ è®€å– EB/SB æ’éšŠæ•¸
   â”‚   â””â”€ è®€å–ç•¶å‰ç›¸ä½
   â”‚
   â”œâ”€ 2.2 æ¯ T_CONTROL ç§’ (60s) é‡æ–°è¨ˆç®—
   â”‚   â”œâ”€ è¨ˆç®—å¹³å‡æµé‡
   â”‚   â”œâ”€ Webster è¨ˆç®—é€±æœŸå’Œç¶ ç‡ˆæ™‚é–“
   â”‚   â”‚   â”œâ”€ è¨ˆç®—æµé‡æ¯” y_EB, y_SB
   â”‚   â”‚   â”œâ”€ è¨ˆç®—æœ€ä½³é€±æœŸ C
   â”‚   â”‚   â””â”€ åˆ†é…ç¶ ç‡ˆæ™‚é–“ G_EB, G_SB
   â”‚   â”‚
   â”‚   â””â”€ PID èª¿æ•´
   â”‚       â”œâ”€ è¨ˆç®—æ’éšŠèª¤å·®
   â”‚       â”œâ”€ PID è¼¸å‡ºèª¿æ•´é‡
   â”‚       â””â”€ æ›´æ–°ç¶ ç‡ˆæ™‚é–“
   â”‚
   â”œâ”€ 2.3 åŸ·è¡Œç›¸ä½åˆ‡æ›
   â”‚   â”œâ”€ åµæ¸¬ç›¸ä½åˆ‡æ›
   â”‚   â”œâ”€ è¨­å®šç¶ ç‡ˆæŒçºŒæ™‚é–“
   â”‚   â””â”€ é»ƒç‡ˆéæ¸¡ (3s)
   â”‚
   â”œâ”€ 2.4 æ”¶é›†çµ±è¨ˆæ•¸æ“š
   â”‚   â”œâ”€ ç´¯ç© Queueã€Halting
   â”‚   â”œâ”€ è¨˜éŒ„ç›¸ä½æ™‚é–“
   â”‚   â””â”€ è¨ˆç®— Reward
   â”‚
   â””â”€ 2.5 æ¨é€²æ¨¡æ“¬ä¸€æ­¥

3. çµæŸ
   â”œâ”€ è¨ˆç®—å¹³å‡å€¼
   â”œâ”€ è¼¸å‡ºçµ±è¨ˆçµæœ
   â””â”€ é—œé–‰ SUMO
```

### âš™ï¸ **é—œéµåƒæ•¸**
- **æ§åˆ¶é€±æœŸ (T_CONTROL)**: 60 ç§’
- **é£½å’Œæµç‡**: 1800 veh/h/lane
- **PID åƒæ•¸**: Kp=0.5, Ki=0.1, Kd=0.2
- **æœ€å°ç¶ ç‡ˆ**: 10 ç§’
- **é»ƒç‡ˆæ™‚é–“**: 3 ç§’

### âœ… **å„ªé»**
- ç†è«–åŸºç¤æˆç†Ÿ
- é©åˆç©©å®šè»Šæµ

### âŒ **ç¼ºé»**
- **åæ‡‰é²éˆ**ï¼š60 ç§’æ‰é‡æ–°è¨ˆç®—ä¸€æ¬¡
- **ç„¡æ³•æ‡‰å°å‹•æ…‹è®ŠåŒ–**ï¼šè¨ˆç®—å‡ºçš„é€±æœŸæ»¯å¾Œæ–¼å¯¦éš›éœ€æ±‚
- **å¯¦é©—è¡¨ç¾æœ€å·®**ï¼šæ’éšŠå’Œå»¶æ»¯æ™‚é–“éƒ½é é«˜æ–¼å…¶ä»–æ–¹æ³•

---

## 4. LLM (Gemini) æ–¹æ³•

### ğŸ“Œ **åŸºæœ¬åŸç†**
ä½¿ç”¨å¤§å‹èªè¨€æ¨¡å‹ (LLM) ä½œç‚ºäº¤é€šè™ŸèªŒæ§åˆ¶ Agentã€‚å°‡äº¤é€šç‹€æ…‹ç·¨ç¢¼ç‚ºè‡ªç„¶èªè¨€æè¿°ï¼ŒLLM æ ¹æ“šæè¿°é€²è¡Œæ¨ç†ä¸¦è¼¸å‡ºæ§åˆ¶æ±ºç­–ã€‚æ¡ç”¨ RAP (Reasoning + Action Prompt) æ–¹æ³•ï¼Œè®“ LLM å…ˆæ€è€ƒå†è¡Œå‹•ã€‚

### ğŸ”§ **ç¨‹å¼æª”æ¡ˆ**
- `traci.LLM.RAP.compare.py`

### **ç‹€æ…‹ç·¨ç¢¼**
å°‡æ•¸å€¼ç‹€æ…‹è½‰æ›ç‚ºè‡ªç„¶èªè¨€ï¼š
```
Traffic Condition at Node2:

East-West Direction (EB):
  - Queue length: 35 vehicles
  - Halting vehicles: 28 vehicles

South-North Direction (SB):
  - Queue length: 42 vehicles
  - Halting vehicles: 35 vehicles

Current Signal Phase: EB (East-West)

Available Actions:
  - "EB": Give green light to East-West direction
  - "SB": Give green light to South-North direction
```

### **æ±ºç­–æµç¨‹**

#### **Prompt è¨­è¨ˆ (RAP Method)**
```
You are an intelligent traffic signal controller.

Traffic Status:
[è‡ªç„¶èªè¨€ç‹€æ…‹æè¿°]

Goal: Minimize queue length and delay.

Task: Decide which phase should be active for the next 20 seconds.
- Option 1: "EB" (East-West Green)
- Option 2: "SB" (South-North Green)

Instructions:
1. Analyze the queue and halting vehicles.
2. If the current green phase still has a long queue, keep it (Extension).
3. If the waiting phase has a much longer queue, switch to it.
4. Output JSON only.

Format:
Thought: <reasoning>
Action: {"phase": "EB" or "SB"}
```

#### **LLM è¼¸å‡ºç¯„ä¾‹**
```
Thought: SB direction has significantly more vehicles (42 vs 35) 
and more halting vehicles (35 vs 28). Should switch to SB.
Action: {"phase": "SB"}
```

### ğŸ”„ **æ§åˆ¶æµç¨‹**

```
1. åˆå§‹åŒ–
   â”œâ”€ è¨­å®š Gemini API
   â”‚   â”œâ”€ æ¨¡å‹: gemini-2.5-flash
   â”‚   â”œâ”€ Temperature: 0.3
   â”‚   â””â”€ Max Tokens: 500
   â”œâ”€ è¨­å®šæ§åˆ¶åƒæ•¸
   â”‚   â”œâ”€ æ§åˆ¶é–“éš”: 20 ç§’ (å›ºå®š)
   â”‚   â”œâ”€ æœ€å°ç¶ ç‡ˆ: 10 ç§’
   â”‚   â””â”€ é»ƒç‡ˆæ™‚é–“: 3 ç§’
   â””â”€ å•Ÿå‹• SUMO æ¨¡æ“¬

2. ä¸»æ§åˆ¶è¿´åœˆ (æ¯ 20 ç§’)
   â”œâ”€ 2.1 è§€å¯Ÿç•¶å‰ç‹€æ…‹
   â”‚   â”œâ”€ è®€å– EB/SB Queue å’Œ Halting
   â”‚   â”œâ”€ è®€å–ç•¶å‰ç›¸ä½
   â”‚   â””â”€ ç·¨ç¢¼ç‚ºè‡ªç„¶èªè¨€æè¿°
   â”‚
   â”œâ”€ 2.2 æ§‹å»º RAP Prompt
   â”‚   â”œâ”€ æ’å…¥ç‹€æ…‹æè¿°
   â”‚   â”œâ”€ å®šç¾©ä»»å‹™ç›®æ¨™
   â”‚   â””â”€ æŒ‡å®šè¼¸å‡ºæ ¼å¼
   â”‚
   â”œâ”€ 2.3 æŸ¥è©¢ LLM
   â”‚   â”œâ”€ ç™¼é€ API è«‹æ±‚
   â”‚   â”œâ”€ ç­‰å¾…å›æ‡‰ (å¹³å‡ 2-3 ç§’)
   â”‚   â””â”€ è™•ç† Rate Limit (429 éŒ¯èª¤)
   â”‚
   â”œâ”€ 2.4 è§£æ LLM å›æ‡‰
   â”‚   â”œâ”€ æå– Thought (æ¨ç†éç¨‹)
   â”‚   â”œâ”€ æå– Action (JSON)
   â”‚   â””â”€ é©—è­‰ç›¸ä½æœ‰æ•ˆæ€§
   â”‚
   â”œâ”€ 2.5 Fallback æ©Ÿåˆ¶
   â”‚   â”œâ”€ å¦‚æœ API å¤±æ•— â†’ Max Pressure
   â”‚   â”œâ”€ å¦‚æœè§£æå¤±æ•— â†’ Max Pressure
   â”‚   â””â”€ å¦‚æœç›¸ä½ç„¡æ•ˆ â†’ Max Pressure
   â”‚
   â”œâ”€ 2.6 åŸ·è¡Œå›ºå®š 20 ç§’å€é–“
   â”‚   â”œâ”€ å¦‚æœç›¸ä½ç›¸åŒ
   â”‚   â”‚   â””â”€ å»¶é•· 20 ç§’ (Extension)
   â”‚   â””â”€ å¦‚æœç›¸ä½ä¸åŒ
   â”‚       â”œâ”€ é»ƒç‡ˆ 3 ç§’
   â”‚       â””â”€ æ–°ç¶ ç‡ˆ 17 ç§’
   â”‚
   â”œâ”€ 2.7 æ”¶é›†çµ±è¨ˆæ•¸æ“š
   â”‚   â”œâ”€ ç´¯ç© Queueã€Halting
   â”‚   â”œâ”€ è¨˜éŒ„ API èª¿ç”¨æ¬¡æ•¸
   â”‚   â”œâ”€ è¨˜éŒ„ Fallback æ¬¡æ•¸
   â”‚   â””â”€ è¨˜éŒ„ API å»¶é²
   â”‚
   â””â”€ 2.8 æ¨é€²æ¨¡æ“¬ (20 ç§’å…§çš„æ‰€æœ‰ steps)

3. çµæŸ
   â”œâ”€ è¨ˆç®—å¹³å‡å€¼
   â”œâ”€ è¼¸å‡ºçµ±è¨ˆçµæœ
   â”‚   â”œâ”€ äº¤é€šæŒ‡æ¨™
   â”‚   â””â”€ LLM æ•ˆèƒ½æŒ‡æ¨™
   â””â”€ é—œé–‰ SUMO
```

### âš™ï¸ **é—œéµåƒæ•¸**
- **LLM æ¨¡å‹**: `gemini-2.5-flash`
- **æ§åˆ¶é–“éš”**: 20 ç§’ (å›ºå®š)
- **Temperature**: 0.3 (è¼ƒä½ï¼Œç¢ºä¿ç©©å®šè¼¸å‡º)
- **Max Tokens**: 500
- **Fallback**: Max Pressure

### **API é™åˆ¶è™•ç†**
```python
# Rate Limit è™•ç†
if "429" in error:
    print("Rate Limit hit! Fallback to Max Pressure.")
    return None  # è§¸ç™¼ Fallback

# é‡è©¦æ©Ÿåˆ¶
max_retries = 3
for attempt in range(max_retries):
    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        if attempt < max_retries - 1:
            time.sleep(2)
        else:
            return None
```

### âœ… **å„ªé»**
- **å¯è§£é‡‹æ€§å¼·**: æ¯æ¬¡æ±ºç­–éƒ½æœ‰ Thought æ¨ç†éç¨‹
- **éˆæ´»æ€§é«˜**: å¯é€é Prompt èª¿æ•´ç­–ç•¥
- **è™•ç†ç‰¹æ®Šå ´æ™¯**: å¯ç†è§£ã€Œäº‹æ•…ã€ã€ã€Œç·Šæ€¥è»Šè¼›ã€ç­‰è¤‡é›œæƒ…å¢ƒ

### âŒ **ç¼ºé»**
- **API å»¶é²**: æ¯æ¬¡æ±ºç­–éœ€ 2-3 ç§’
- **Rate Limit**: å…è²»ç‰ˆæœ‰åš´æ ¼çš„è«‹æ±‚é™åˆ¶
- **æ•ˆèƒ½ä¸ä½³**: å¯¦é©—ä¸­æ’åç¬¬ 3ï¼Œè½å¾Œæ–¼ PPO å’Œ Max Pressure
- **ä¸ç©©å®š**: é«˜ Fallback ç‡ (37.7%)

### **å¯¦é©—çµæœ**
- **Avg Queue**: 66.61 veh (ç¬¬ 3 å)
- **Avg Delay**: 42.65 s (ç¬¬ 3 å)
- **Fallback Rate**: 37.7%
- **çµè«–**: å„ªæ–¼ Websterï¼Œä½†ç„¡æ³•æŒ‘æˆ° PPO/MaxP

---

## 5. æ¼”ç®—æ³•æ¯”è¼ƒç¸½çµ

### **æ•ˆèƒ½æ’å**

| æ’å | æ–¹æ³• | Avg Queue | Avg Delay | ç‰¹é» |
|------|------|-----------|-----------|------|
| 1 | **PPO** | 40.58 veh | 21.01 s | æœ€å„ªæ•ˆèƒ½ï¼Œéœ€é è¨“ç·´ |
| 2 | **Max Pressure** | 40.60 veh | 21.02 s | å³æ’å³ç”¨ï¼Œæ¥µç°¡é«˜æ•ˆ |
| 3 | **LLM (Gemini)** | 66.61 veh | 42.65 s | å¯è§£é‡‹ï¼Œä½†å—é™æ–¼ API |
| 4 | **Webster + PID** | 73.10 veh | 48.25 s | åæ‡‰é²éˆï¼Œä¸é©åˆå‹•æ…‹å ´æ™¯ |

### **ç‰¹æ€§æ¯”è¼ƒ**

| ç‰¹æ€§ | PPO | Max Pressure | Webster + PID | LLM |
|------|-----|--------------|---------------|-----|
| **è¨“ç·´éœ€æ±‚** | éœ€è¦ | ä¸éœ€è¦ | ä¸éœ€è¦ | ä¸éœ€è¦ |
| **å¯¦æ™‚æ€§** | æ¥µå¿« | æ¥µå¿« | æ…¢ (60s é€±æœŸ) | æ…¢ (API å»¶é²) |
| **å¯è§£é‡‹æ€§** | é»‘ç®± | ç‰©ç†æ„ç¾©æ˜ç¢º | ç†è«–åŸºç¤æˆç†Ÿ | æœ€å¼· (Thought) |
| **é©æ‡‰æ€§** | æœ€å¼· | å¼· | å¼± | å¼· (ç†è«–ä¸Š) |
| **éƒ¨ç½²é›£åº¦** | é«˜ | ä½ | ä¸­ | é«˜ (éœ€ API) |
| **è¨ˆç®—æˆæœ¬** | ä¸­ | ä½ | ä½ | é«˜ (API è²»ç”¨) |

---

## **åƒè€ƒæ–‡ç»**

1. **PPO**: Schulman et al., "Proximal Policy Optimization Algorithms", arXiv:1707.06347
2. **Max Pressure**: Varaiya, "Max pressure control of a network of signalized intersections", Transportation Research Part C, 2013
3. **Webster**: Webster, F.V., "Traffic Signal Settings", Road Research Technical Paper No. 39, 1958
4. **LLM for Traffic**: "Large Language Models as Traffic Signal Control Agents", arXiv:2312.16044v5

---

**æ–‡ä»¶çµæŸ**
